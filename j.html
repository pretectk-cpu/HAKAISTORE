<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raspadinha da Fazenda</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --card-width: 400px;
            --card-height: 200px;
            --font-title: 'Luckiest Guy', cursive;
            --font-body: 'Roboto Slab', serif;
            --color-wood-dark: #8B4513;
            --color-wood-light: #A0522D;
            --color-text-light: #F5DEB3;
            --color-green: #2E8B57;
            --color-green-hover: #3CB371;
            --color-gold: #FFD700;
        }

        body {
            font-family: var(--font-body);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            color: var(--color-text-light);
            background-image: url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1932&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            overflow-x: hidden;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: -1;
        }

        h1 {
            font-family: var(--font-title);
            font-size: 3.5rem;
            color: #fff;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.7);
            animation: fadeInDown 1s ease-out;
            text-align: center;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: linear-gradient(145deg, var(--color-wood-light), var(--color-wood-dark));
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 0 15px rgba(0,0,0,0.3);
            text-align: center;
            animation: fadeInUp 1s ease-out;
            border: 5px solid #654321;
            z-index: 10;
        }
        
        #login-form, #scratch-area, #payment-info-area {
            display: none;
        }
        #login-form.active, #scratch-area.active, #payment-info-area.active {
            display: block;
        }

        h2 {
            font-family: var(--font-title);
            font-size: 2rem;
            margin-bottom: 20px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .input-group { margin-bottom: 20px; }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
        }
        .input-group input {
            width: calc(100% - 24px);
            padding: 12px;
            border: 2px solid var(--color-wood-dark);
            border-radius: 10px;
            background: var(--color-text-light);
            color: var(--color-wood-dark);
            font-family: var(--font-body);
            font-size: 1rem;
        }

        #login-message {
            color: #FFC0CB;
            font-weight: 700;
            min-height: 20px;
        }

        .main-button {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: var(--font-body);
            cursor: pointer;
            border-radius: 50px;
            border: none;
            background: var(--color-green);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
        }
        .main-button:hover {
            background: var(--color-green-hover);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        .secondary-button {
            background: transparent;
            border: 2px solid var(--color-text-light);
            color: var(--color-text-light);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        .secondary-button:hover {
            background: rgba(245, 222, 179, 0.2);
            transform: translateY(-2px);
        }

        #scratch-container {
            position: relative;
            width: var(--card-width);
            height: var(--card-height);
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            cursor: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABFklEQVRYR9WXURLDIAhE4/8/uhdIraAL8wE7dJEsQpI2nAN5kR9wdgY47QJwzTynoAcg7gBMiA7gGQEi4DmAkx8b2JqgL4FgjABsCgB1xTgWgCUJgIswqgJoSQDchVEbYFEAYBfGY4FVAYBbGIsFtgQANCf2CawLADQlLoBNgLgD8BEg3oD/gZgfcA/AlwQ8APgSwIcE/AxQ/4J8/zY+u7f753n+N7l83t/vj8/vR/z+P/7f65f57z9e3/++f/69f/f78/f/9w8A6AbgD4B6A/4DqP8B+APg9yV4LgCfJcA/AV/2A/jZB/A3oB/gZz/Az4B+gJ/9AfwM6A/42Q/gZ0/4M9+gJ8B/QG/5y/bA04d1k2yAQAAAABJRU5ErkJggg==') 16 16, auto;
            margin: 20px auto;
            animation: fadeInUp 1s ease-out;
            overflow: hidden;
        }

        #prize-area {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: 700; color: var(--color-wood-dark);
            background: linear-gradient(45deg, #f1c40f, var(--color-gold), #e67e22);
            text-align: center; padding: 10px; box-sizing: border-box; user-select: none;
        }
        
        #prize-area.winner .prize-text {
            animation: textShine 2s infinite;
            background: linear-gradient(to right, #2c3e50 20%, #e74c3c 40%, #e74c3c 60%, #2c3e50 80%);
            background-size: 200% auto;
            color: transparent; -webkit-background-clip: text; background-clip: text;
        }

        #scratch-card {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 15px; transition: opacity 1.5s ease-out;
        }
        #scratch-card.revealed { opacity: 0; }

        #payment-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: none; align-items: center;
            justify-content: center; z-index: 1000;
        }
        #payment-modal.active { display: flex; }

        .payment-content {
            background: linear-gradient(145deg, var(--color-wood-light), var(--color-wood-dark));
            padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); border: 5px solid #654321;
            text-align: center; width: 90%; max-width: 400px;
        }

        /* --- NOVO: Estilos para o Feed de Ganhadores --- */
        #winners-feed-container {
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
            background: rgba(69, 39, 10, 0.8); /* Madeira escura translúcida */
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border: 3px solid #654321;
            max-height: 250px;
            overflow: hidden;
            display: none; /* Começa oculto */
        }
        #winners-feed-container.active {
            display: block;
        }

        #winners-feed-container h3 {
            font-family: var(--font-title);
            margin: 0 0 15px 0;
            text-align: center;
            font-size: 1.5rem;
            color: var(--color-text-light);
            text-shadow: 2px 2px 2px #000;
        }

        #winners-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #winners-list li {
            background: rgba(245, 222, 179, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            animation: slideIn 0.5s ease-out forwards;
        }

        #winners-list li .winner-name {
            font-weight: 700;
            color: #fff;
        }

        #winners-list li .winner-prize {
            font-weight: 700;
        }
        
        /* Cores para os prêmios */
        .prize-1sx { color: #CFD8DC; } /* Cinza claro */
        .prize-dragonfly { color: #81D4FA; } /* Azul claro */
        .prize-mimic { color: #CE93D8; } /* Roxo */
        .prize-kitsune-red { color: var(--color-gold); font-weight: bold; text-shadow: 0 0 5px var(--color-gold); } /* Dourado brilhante */


        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* --- FIM DOS NOVOS ESTILOS --- */


        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-40px); } to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); }
        }
        @keyframes textShine {
            to { background-position: -200% center; }
        }

        @media (max-width: 480px) {
            :root { --card-width: 300px; --card-height: 150px; }
            h1 { font-size: 2.5rem; } h2 { font-size: 1.8rem; }
            #prize-area { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <h1>Raspadinha da Fazenda</h1>
    
    <div class="container">
        <div id="login-form">
            <h2>Acesso Único</h2>
            <div class="input-group">
                <label for="username">Seu Login:</label>
                <input type="text" id="username" placeholder="Digite seu login único" required>
            </div>
            <p id="login-message">&nbsp;</p>
            <button id="login-button" class="main-button">Entrar na Fazenda</button>
        </div>
        
        <div id="scratch-area">
            <div id="scratch-container">
                <div id="prize-area"></div>
                <canvas id="scratch-card"></canvas>
            </div>
            <p style="margin-top: 20px;">Use o mouse (ou o dedo) e raspe para revelar seu prêmio!</p>
        </div>

        <div id="payment-info-area">
            <h2>Fim de Jogo</h2>
            <p>Você já usou sua raspadinha. Gostaria de tentar a sorte novamente?</p>
            <button id="buy-new-scratch-button" class="main-button">Comprar Nova Raspadinha</button>
            <button id="back-to-menu-button" class="secondary-button">Sair</button>
        </div>
    </div>
    
    <div id="winners-feed-container">
        <h3>Últimos Ganhadores</h3>
        <ul id="winners-list"></ul>
    </div>
    
    <div id="payment-modal">
        <div class="payment-content">
            <h2>Caixa da Fazenda</h2>
            <p>Uma nova chance de ganhar custa apenas R$ 5,00. Deseja continuar?</p>
            <button id="pay-now-button" class="main-button">Pagar Agora</button>
            <button id="cancel-payment-button" class="secondary-button">Cancelar</button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ELEMENTOS DO DOM ---
            const loginForm = document.getElementById('login-form');
            const scratchArea = document.getElementById('scratch-area');
            const paymentInfoArea = document.getElementById('payment-info-area');
            const paymentModal = document.getElementById('payment-modal');
            const loginButton = document.getElementById('login-button');
            const usernameInput = document.getElementById('username');
            const loginMessage = document.getElementById('login-message');
            const prizeArea = document.getElementById('prize-area');
            const canvas = document.getElementById('scratch-card');
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            const container = document.getElementById('scratch-container');
            const buyNewScratchButton = document.getElementById('buy-new-scratch-button');
            const backToMenuButton = document.getElementById('back-to-menu-button');
            const payNowButton = document.getElementById('pay-now-button');
            const cancelPaymentButton = document.getElementById('cancel-payment-button');
            const winnersFeedContainer = document.getElementById('winners-feed-container'); // NOVO
            const winnersList = document.getElementById('winners-list'); // NOVO


            // --- CONFIGURAÇÕES E ESTADO DO JOGO ---
            const validUsers = Array.from({length: 20}, (_, i) => `raiky${i + 1}`);
            
            // NOVO: Sistema de prêmios com as novas porcentagens (usadas como pesos)
            const prizes = [
                { name: 'Kitsune Red', message: 'LENDÁRIO! Você ganhou uma Kitsune Vermelha!', weight: 0.001, isWinner: true, className: 'prize-kitsune-red' },
                { name: 'Mimic', message: 'Incrível! Você ganhou um Mímico!', weight: 5, isWinner: true, className: 'prize-mimic' },
                { name: 'Dragonfly', message: 'Parabéns! Você ganhou uma Libélula!', weight: 10, isWinner: true, className: 'prize-dragonfly' },
                { name: '1sx', message: 'Você ganhou 1sx!', weight: 60, isWinner: true, className: 'prize-1sx' },
                { name: 'Sem Sorte', message: 'Que pena! Tente novamente na próxima!', weight: 24.999, isWinner: false, className: 'prize-nothing' }
            ];

            const CURRENT_USER_KEY = 'currentUser';
            const SCRATCH_USED_KEY = 'scratchUsed';
            const USED_USERS_KEY = 'usedUsers';

            let isDrawing = false;
            let gameReady = false;

            // --- LÓGICA DE GERENCIAMENTO DE UI ---

            function switchView(view) {
                loginForm.classList.remove('active');
                scratchArea.classList.remove('active');
                paymentInfoArea.classList.remove('active');
                winnersFeedContainer.classList.remove('active'); // NOVO: Esconde o feed por padrão
                
                if (view === 'login') {
                    loginForm.classList.add('active');
                    winnersFeedContainer.classList.add('active'); // NOVO: Mostra o feed na tela de login
                } else if (view === 'scratch') {
                    scratchArea.classList.add('active');
                } else if (view === 'payment') {
                    paymentInfoArea.classList.add('active');
                }
            }
            
            function checkAccess() {
                const currentUser = localStorage.getItem(CURRENT_USER_KEY);
                const scratchUsed = localStorage.getItem(SCRATCH_USED_KEY) === 'true';

                if (!currentUser) {
                    switchView('login');
                } else if (scratchUsed) {
                    switchView('payment');
                } else {
                    switchView('scratch');
                    if (!gameReady) {
                        setupScratchCard();
                        gameReady = true;
                    }
                }
            }

            // --- NOVO: LÓGICA DO FEED DE GANHADORES FAKE ---

            function generateFakeUsername() {
                const prefixes = ['Super', 'Mega', 'Shadow', 'Dark', 'Cyber', 'Lorde', 'Mestre'];
                const nouns = ['Gamer', 'Hunter', 'Fox', 'Ninja', 'Player', 'Lobo', 'Leão'];
                const suffixes = ['BR', 'X', 'Pro', '99', '123', ''];
                const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
                const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
                const randomSuffix = suffixes[Math.floor(Math.random() * suffixes.length)];
                return `${randomPrefix}${randomNoun}${randomSuffix}`;
            }

            function addFakeWinner() {
                // Usa a mesma função de determinar prêmio para ser realista
                const prizeWon = determinePrize();
                if (!prizeWon.isWinner) return; // Não mostra "perdedores" no feed

                const newWinner = document.createElement('li');
                
                // Formata o prêmio com sua classe de cor específica
                const prizeHTML = `<span class="winner-prize ${prizeWon.className}">${prizeWon.name}</span>`;
                
                newWinner.innerHTML = `
                    <span class="winner-name">${generateFakeUsername()}</span>
                    ${prizeHTML}
                `;
                
                winnersList.prepend(newWinner);

                // Mantém a lista com no máximo 7 itens
                if (winnersList.children.length > 7) {
                    winnersList.lastChild.remove();
                }
            }

            // Inicia o feed de ganhadores
            setInterval(addFakeWinner, 3500); // Adiciona um novo ganhador a cada 3.5 segundos


            // --- LÓGICA DE LOGIN, PAGAMENTO E OUTROS ---
            // (O resto do código permanece o mesmo, com uma pequena alteração na função `determinePrize`)
            
            loginButton.addEventListener('click', () => {
                const username = usernameInput.value.trim().toLowerCase();
                let usedUsers = JSON.parse(localStorage.getItem(USED_USERS_KEY)) || [];
                loginMessage.textContent = '\xa0';
                if (!username) { loginMessage.textContent = 'Por favor, digite um login.'; return; }
                if (!validUsers.includes(username)) { loginMessage.textContent = 'Login inválido. Tente novamente.'; return; }
                if (usedUsers.includes(username)) { loginMessage.textContent = 'Este login já foi utilizado.'; return; }
                localStorage.setItem(CURRENT_USER_KEY, username);
                localStorage.setItem(SCRATCH_USED_KEY, 'false');
                usedUsers.push(username);
                localStorage.setItem(USED_USERS_KEY, JSON.stringify(usedUsers));
                checkAccess();
            });

            buyNewScratchButton.addEventListener('click', () => paymentModal.classList.add('active'));
            payNowButton.addEventListener('click', () => {
                alert('Pagamento aprovado! Boa sorte na sua nova raspadinha!');
                paymentModal.classList.remove('active');
                localStorage.setItem(SCRATCH_USED_KEY, 'false');
                gameReady = false;
                checkAccess();
            });
            cancelPaymentButton.addEventListener('click', () => paymentModal.classList.remove('active'));
            backToMenuButton.addEventListener('click', () => {
                localStorage.removeItem(CURRENT_USER_KEY);
                localStorage.removeItem(SCRATCH_USED_KEY);
                gameReady = false;
                usernameInput.value = '';
                checkAccess();
            });

            // --- LÓGICA DA RASPADINHA ---

            function determinePrize() {
                const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
                let random = Math.random() * totalWeight;
                for (const prize of prizes) {
                    if (random < prize.weight) return prize;
                    random -= prize.weight;
                }
            }

            function setupScratchCard() {
                const rect = container.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
                const chosenPrize = determinePrize();
                prizeArea.className = chosenPrize.isWinner ? 'winner' : '';
                prizeArea.innerHTML = `<span class="prize-text">${chosenPrize.message}</span>`;
                canvas.classList.remove('revealed');
                ctx.globalCompositeOperation = 'source-over';
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#bdc3c7');
                gradient.addColorStop(1, '#7f8c8d');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.font = 'bold 24px "Luckiest Guy"';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('RASPE AQUI', canvas.width / 2, canvas.height / 2);
                ctx.globalCompositeOperation = 'destination-out';
            }

            function revealPrize() {
                isDrawing = false;
                canvas.classList.add('revealed');
                setTimeout(() => {
                    localStorage.setItem(SCRATCH_USED_KEY, 'true');
                    checkAccess();
                }, 3000);
            }

            function getScratchPercentage() {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const pixels = imageData.data; let transparentPixels = 0;
                for (let i = 3; i < pixels.length; i += 4) { if (pixels[i] === 0) transparentPixels++; }
                return (transparentPixels / (canvas.width * canvas.height)) * 100;
            }
            
            function scratch(e) {
                if (!isDrawing) return; e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                ctx.beginPath(); ctx.arc(x, y, 25, 0, Math.PI * 2, true); ctx.fill();
                if (getScratchPercentage() > 70) { revealPrize(); }
            }
            
            canvas.addEventListener('mousedown', (e) => { isDrawing = true; scratch(e); });
            canvas.addEventListener('touchstart', (e) => { isDrawing = true; scratch(e); });
            canvas.addEventListener('mouseup', () => isDrawing = false);
            canvas.addEventListener('mouseleave', () => isDrawing = false);
            canvas.addEventListener('touchend', () => isDrawing = false);
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('touchmove', scratch);
            
            window.addEventListener('resize', () => {
                if (scratchArea.classList.contains('active')) {
                    gameReady = false; checkAccess();
                }
            });

            // --- INICIALIZAÇÃO ---
            checkAccess();
        });
    </script>

</body>
</html>
